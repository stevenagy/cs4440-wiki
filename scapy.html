<!DOCTYPE html>
<html lang="en">
<head>
    <title>CS 4440</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons/css/academicons.min.css">
    <link rel="stylesheet" href="css/main.css"/>
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://kit.fontawesome.com/982c2a20d7.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</head>

<body>

<div id="navbar-placeholder" data-wiki-root="" data-site-root="../"></div>
<script src="js/navbar.js"></script>

<!-- ################################################################################### -->

<div class="container main-container" role="main">
    <div class="row">
    <div class="col-lg-9">
        <h1>CS 4440 Wiki: <br class="on-narrow"><strong style="color:var(--color-blue)">Scapy Cheat Sheet</strong></h1><br>

    <!-- ################################################################################### -->

        <p>Below is an abridged cheat sheet of Scapy fundamentals that you'll use in this course.</p>

        <p><strong>This page is by no means comprehensive—we encourage you to bookmark and familiarize yourself with one of the many in-depth Scapy tutorials on the web.</strong> Some great examples are:</p>

        <ul>
            <li><a href="https://scapy.readthedocs.io/en/latest/api/scapy.html">Scapy Library</a></li>
            <li><a href="https://scapy.readthedocs.io/en/latest/usage.html">Scapy Usage</a></li>
        </ul>

    <!-- ################################################################################### -->

        <hr><h2 id=basics>Scapy Basics</h2>

        <p id=basics#install>In case Scapy is not installed on your VM, just run <code>$ pip3 install scapy</code> in your VM's terminal. Once installed, here's how you can import Scapy in Python:</p> 
        <pre tabindex="0">from scapy.all import *</pre>

        <p id=basics#pcap><strong><code>rdpcap('&#10092;pcap&#10093;')</code> : </strong> Retrieve packets from a packet capture file.</p>
        <pre tabindex="0">
>>> packets = rdpcap('crack0.pcap')
>>> packet = packets[0]</pre>

        <p id=basics#layers><strong><code>packet.show()</code> : </strong> Show available protocols and fields for a packet.</p>
        <pre tabindex="0">
>>> packet.show()
###[ Ethernet ]###
    dst       = 08:00:27:6e:cf:4a
    src       = 0a:00:27:00:00:00
    ...
###[ IP ]###
    version   = 4
    ihl       = 5
    ...
###[ TCP ]###
    sport     = 54017
    dport     = ftp
    ...</pre>

        <p id=basics#haslayer><strong><code>packet.haslayer('&#10092;protocol&#10093;')</code> : </strong>Check if packet contains the given protocol.</p>
        <pre tabindex="0">
>>> packet.haslayer('TCP') 
True</pre>

        <p id=basics#payload><strong><code>packet['&#10092;protocol&#10093;'].payload</code> : </strong> Retrieve the protocol's <strong>payload</strong>.</p>
        <pre tabindex="0">
>>> packet['TCP'].payload
&lt;Raw  load=b'220 redmint FTP server (Version 6.4/OpenBSD/Linux-ftpd-0.17) ready.\r\n' |></pre>

    <!-- ################################################################################### -->

        <hr><h2 id=link>Link Layer</h2>

        <p id=link#src><strong><code>packet['&#10092;protocol&#10093;'].src</code> : </strong>The packet's <strong>source address</strong> for the <strong>link layer</strong>.</p>
        <pre tabindex="0">
>>> packet['Ethernet'].src
'0a:00:27:00:00:00'</pre>

        <p id=link#dst><strong><code>packet['&#10092;protocol&#10093;'].dst</code> : </strong>The packet's <strong>destination address</strong> for the <strong>link layer</strong>.</p>
        <pre tabindex="0">
>>> packet['Ethernet'].dst
'08:00:27:6e:cf:4a'</pre>

    <!-- ################################################################################### -->

        <hr><h2 id=network>Network Layer</h2>

        <p id=network#version><strong><code>packet['&#10092;protocol&#10093;'].version</code> : </strong>The packet's protocol <strong>version</strong>. For example, IPv4 or IPv6.</p>
        <pre tabindex="0">
>>> packet['IP'].version
4</pre>

        <p id=network#src><strong><code>packet['&#10092;protocol&#10093;'].src</code> : </strong>The packet's <strong>source address</strong> for the <strong>network layer</strong>.</p>
        <pre tabindex="0">
>>> packet['IP'].src
'192.168.56.1'</pre>

        <p id=network#dst><strong><code>packet['&#10092;protocol&#10093;'].dst</code> : </strong>The packet's <strong>destination address</strong> for the <strong>network layer</strong>.</p>
        <pre tabindex="0">
>>> packet['IP'].dst
'192.168.56.101'</pre>

    <!-- ################################################################################### -->

        <hr><h2 id=transport>Transport Layer</h2>

        <p id=transport#sport><strong><code>packet['&#10092;protocol&#10093;'].sport</code> : </strong>The packet's <strong>source port</strong> for the <strong>transport layer</strong>.</p>
        <pre tabindex="0">
>>> packet['TCP'].sport
54017</pre>

        <p id=transport#dport><strong><code>packet['&#10092;protocol&#10093;'].dport</code> : </strong>The packet's <strong>destination port</strong> for the <strong>transport layer</strong>.</p>
        <pre tabindex="0">
>>> packet['TCP'].dport
21</pre>

        <p id=transport#flags><strong><code>packet['&#10092;protocol&#10093;'].flags</code> : </strong>Inspect a packet's <strong>flags</strong>.</p>
        <pre tabindex="0">
>>> packet["TCP"].flags == 'S'  # Check for SYN flag
True

>>> packet["TCP"].flags.S   # Check for SYN flag
True</pre>

    <!-- ################################################################################### -->

        <hr><h2 id=app>Application Layer</h2>

        <p id=app#data>You can use the <code>payload</code> to grab a packet's <strong>application layer</strong> data from the transport layer.</p>
        <pre tabindex="0">
>>> bytes(packet["TCP"].payload).decode("utf-8", "replace")
'220 redmint FTP server (Version 6.4/OpenBSD/Linux-ftpd-0.17) ready.\r\n'</pre>

        <br>

    <!-- ################################################################################### -->


    <!-- ################################################################################### -->
    </div>
    <div class="col-lg-3">
        <nav class="sidebar-toc" aria-label="Table of Contents">
            <h4><strong>Table of Contents:</strong></h4>
                <ul>
                    <li><a href="#basics">Scapy Basics</a>
                    <ul>
                        <li><a href="#basics#install">Installing Scapy</a></li>
                        <li><a href="#basics#pcap">PCAP</a></li>
                        <li><a href="#basics#layers">Show Layers</a></li>
                        <li><a href="#basics#haslayer">Has Layer</a></li>
                        <li><a href="#basics#payload">Payload</a></li>
                    </ul>
                    </li>
                    <li style="margin-top:1ex"><a href="#link">Link Layer</a>
                    <ul>
                        <li><a href="#link#src">Source</a></li>
                        <li><a href="#link#dst">Destination</a></li>
                    </ul>
                    </li>
                    <li style="margin-top:1ex"><a href="#network">Network Layer</a>
                    <ul>
                        <li><a href="#network#version">Version</a></li>
                        <li><a href="#network#src">Source</a></li>
                        <li><a href="#network#dst">Destination</a></li>
                    </ul>
                    </li>
                    <li style="margin-top:1ex"><a href="#transport">Transport Layer</a>
                    <ul>
                        <li><a href="#transport#sport">Source Port</a></li>
                        <li><a href="#transport#dport">Destination Port</a></li>
                        <li><a href="#transport#dport">Flags</a></li>
                    </ul>
                    </li>
                    <li style="margin-top:1ex"><a href="#app">Application Layer</a>
                    <ul>
                        <li><a href="#app#data">Data</a></li>
                    </ul>
                    </li>
                </ul>
        </nav>
    </div>

</div>
</div>

<!-- ################################################################################### -->

<footer class="bg-light text-center text-lg-start" role="contentinfo">
    <div class="text-center p-3">
        Copyright © Stefan Nagy. All rights reserved.
    </div>
</footer>

<!-- ################################################################################### -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>document.querySelectorAll('pre').forEach(el => el.setAttribute('tabindex', '0'));</script>
</body>

</html>
